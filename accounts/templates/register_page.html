<!DOCTYPE html>
<html>
  <head>
    <title>Registro - Maric√° City</title>
    <script>
      async function checkUsername() {
        const username = document.getElementById('username').value
        const feedback = document.getElementById('username-feedback')
        if (!username) {
          feedback.textContent = ''
          return
        }
        const res = await fetch(`/accounts/check_username/?username=${username}`)
        const data = await res.json()
        if (data.exists) {
          feedback.style.color = 'red'
          feedback.textContent = 'Username already taken'
        } else {
          feedback.style.color = 'green'
          feedback.textContent = 'Username available'
        }
      }
    </script>
  </head>
  <body>
    <h1>Registro</h1>
    {% if messages %}
      {% for message in messages %}
        <p style="color:red;">{{ message }}</p>
      {% endfor %}
    {% endif %}
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ next }}" />
      <label>Usuario:</label>
      <input type="text" name="username" id="username" value="{{ prefill_username }}" oninput="checkUsername()" required />
      <span id="username-feedback"></span><br />
      <label>Senha:</label>
      <input type="password" name="password" required /><br />
      <button type="submit">Register</button>
    </form>
  </body>
</html>
